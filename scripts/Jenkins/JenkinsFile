node {
    def goHome = tool('Go 1.13.7')


    try{

        ws("${JENKINS_HOME}/jobs/${JOB_NAME}/builds/${BUILD_ID}/src/github.com/rohan-luthra/service-restaurant-go") {
            withEnv(["GOROOT=${goHome}", "GOPATH=${JENKINS_HOME}/jobs/${JOB_NAME}/builds/${BUILD_ID}", "PATH+GO=${goHome}/bin"]) {

                stage('Checkout'){
                    echo 'Checking out SCM'
                    checkout scm
                    sh 'ls'
                    sh 'pwd'
                }

                
                stage('Pre Test'){
                    echo 'Pulling Dependencies'

                    sh 'go version'
                    sh 'go get -u github.com/golang/dep/cmd/dep'
                    // sh 'go get -u github.com/golang/lint/golint'
                    // sh 'go get github.com/tebeka/go2xunit'
                    
                    //or -update
                    sh '$GOPATH/bin/dep ensure'  
                }

            }
        }

    }catch (err){
        sh 'echo ERROR'
    }

    
}